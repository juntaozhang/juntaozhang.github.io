# 数据湖概述与架构

## 一、数据湖核心特征

### 1. 支持全类型数据存储
- **结构化数据**：数据库表、CSV等
- **半结构化数据**：JSON、日志等
- **非结构化数据**：图片、音频、视频等
- 打破传统存储对数据格式的限制

### 2. 读时模式（Schema-on-Read）
- 数据写入时无需定义表结构，Schema延迟到读取时确定
- 一份数据支持多场景复用（如用户行为日志可同时用于用户画像和风控分析）

### 3. 低成本海量扩展
- 基于HDFS、S3、OSS等低成本存储系统
- 轻松支撑PB级甚至EB级数据存储
- 存储成本远低于传统数据仓库

### 4. 多引擎兼容
- 对接多种计算引擎，同时支持离线批处理、实时流处理和机器学习训练

## 二、数据湖与数据仓库比较

| 对比维度 | 数据仓库 | 数据湖 |
|---------|---------|-------|
| Schema策略 | 写时模式（Schema-on-Write）：写入前定义严格结构 | 读时模式（Schema-on-Read）：写入时无结构限制 |
| 支持数据类型 | 仅结构化数据 | 全类型数据（结构化、半结构化、非结构化） |
| 存储成本 | 专属高性能存储，成本高 | 低成本对象存储，成本低 |
| 扩展性 | 相对受限 | PB/EB级海量扩展 |
| 适用场景 | 固定、成熟的业务分析（月度报表、财务核算等） | 灵活、探索性分析（机器学习、日志挖掘等） |

## 三、数据处理架构流程

### 典型架构：数据源 → 数据湖 → 数据仓库 → 应用层

1. **数据源层**
   - 业务数据库（MySQL/Oracle）
   - 日志数据（Nginx/Flume）
   - 埋点数据
   - IoT数据
   - **采集工具**：Flink、Kafka、Sqoop

2. **数据湖层（狭义）**
   - **存储介质**：S3、HDFS、OSS等对象存储
   - **存储格式**：Parquet、ORC、JSON、日志文件、二进制文件
   - **加工工具**：Spark、Flink

3. **数据仓库层**
   - **分层结构**：明细层、汇总层、应用层
   - **特性**：按业务主题组织，支持ACID事务、SQL分析
   - **查询工具**：StarRocks、Trino、Hive、Impala

4. **应用层**
   - BI报表（Tableau、Quick BI）
   - 机器学习模型训练
   - 实时监控系统
   - 决策分析平台

## 四、云原生数据湖趋势

### 1. 存算分离架构
- 存储与计算资源独立扩展
- 降低基础设施成本

### 2. 批流融合
- 一份数据同时支持批处理和流处理
- 避免数据重复存储

### 3. 湖仓一体表格式
- **代表技术**：Iceberg、Delta Lake、Paimon
- **优势**：
  - 支持批流融合（尤其是Paimon）
  - 提供统一catalog接口，解耦计算与存储
  - 多引擎兼容（Flink、Spark、Trino、StarRocks等）
  - 深度适配K8s和Serverless架构

### 4. OSS替代HDFS
- **原因**：
  - 更低的存储成本
  - 避免HDFS的NameNode元数据管理瓶颈
  - 更好的云原生兼容性

## 五、数据湖技术栈

### 1. 存储层
- **核心组件**：
  - HDFS：传统分布式文件系统
  - MinIO：开源对象存储系统
  - 阿里云OSS：云对象存储服务
  - AWS S3：亚马逊云对象存储服务
- **存储格式**：Parquet、ORC、JSON、日志文件、二进制文件

### 2. 采集层
- **核心组件**：
  - Flume：日志采集工具
  - Kafka：实时数据传输平台
  - Sqoop：批量数据同步工具
- **功能**：将各类数据源的数据采集到数据湖中

### 3. 处理层
- **核心组件**：
  - Spark：分布式计算框架
    - 支持批处理（Spark SQL、DataFrame）
    - 支持流处理（Spark Streaming、Structured Streaming）
    - 支持机器学习（MLlib）
  - Flink：分布式流处理框架
    - 低延迟实时处理
    - 支持状态管理
    - 精确一次处理语义
- **功能**：对数据湖中的原始数据进行清洗、转换、聚合等加工处理

### 4. 直接计算层
- **核心组件**：
  - Trino：分布式SQL查询引擎
    - 支持跨数据源查询
    - 内存计算，查询速度快
    - 支持多种连接器（Hive、Iceberg、Delta Lake等）
  - StarRocks：MPP架构分析型数据库
    - 高性能OLAP查询
    - 支持实时更新
    - 内置丰富的分析函数
- **功能**：直接对数据湖中的数据进行高性能查询和分析，无需先导入到数据仓库

### 5. 元数据管理层
- Catalog(Paimon/Hive/Iceberg/Delta Lake)
- Apache Atlas / OpenMetadata